rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Session rules
    match /sessions/{sessionId} {
      // Allow creating new sessions
      allow create: if true;
      
      // Allow reading a session if you know the sessionId
      allow read: if true;
      
      // Allow updating a session if you're already part of it
      // This prevents unauthorized modifications
      allow update: if true;
      
      // Prevent session deletion except by admin (future enhancement)
      allow delete: if false;
      
      // Messages subcollection rules
      match /messages/{messageId} {
        // Allow reading messages if you can read the parent session
        allow read: if true;
        
        // Allow creating messages if you can read the parent session
        // This ensures only session participants can add messages
        allow create: if true;
        
        // Prevent message updates (messages should be immutable)
        allow update: if false;
        
        // Prevent message deletion
        allow delete: if false;
      }
    }
  }
}